; Supervisord configuration for Solana Intel Engine
; Alternative to systemd for environments without it

[unix_http_server]
file=/tmp/supervisor.sock

[supervisord]
logfile=/var/log/solana-intel/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/tmp/supervisord.pid
nodaemon=false
minfds=1024
minprocs=200

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; ============================================================================
; PROGRAM DEFINITIONS
; ============================================================================

[program:intel-engine]
command=/opt/solana-intel-engine/.venv/bin/python main.py
directory=/opt/solana-intel-engine
user=solana
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=30
killasgroup=true
stopasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/solana-intel/engine.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=HOME="/home/solana",USER="solana"

[program:ingestion]
command=/opt/solana-intel-engine/.venv/bin/python -m ingestion.main
directory=/opt/solana-intel-engine
user=solana
autostart=true
autorestart=true
startsecs=5
startretries=5
stopwaitsecs=10
killasgroup=true
stopasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/solana-intel/ingestion.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=HOME="/home/solana",USER="solana"

[program:api-server]
command=/opt/solana-intel-engine/.venv/bin/uvicorn api.main:app --host 0.0.0.0 --port 8000 --workers 2
directory=/opt/solana-intel-engine
user=solana
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=30
killasgroup=true
stopasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/solana-intel/api.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=HOME="/home/solana",USER="solana"

; ============================================================================
; GROUP DEFINITIONS
; ============================================================================

[group:solana-intel]
programs=intel-engine,ingestion,api-server
priority=999
